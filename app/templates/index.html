{% extends "base.html" %}
{% block content %}
<p class="section-label">Internal Tools</p>
<h2>Available Scripts ({{ scripts|length }})</h2>
{% if scripts %}
<div class="script-list">
    {% for s in scripts %}
    <div class="script-card">
        <div class="script-info">
            <h3>{{ s.name }}</h3>
            <p>{{ s.description }}</p>
        </div>
        <form method="post" action="/run/{{ s.id }}">
            <button type="submit" class="run-btn">Run</button>
        </form>
    </div>
    {% endfor %}
</div>
{% else %}
<p class="empty">No scripts found.</p>
{% endif %}

<section class="upload-section">
    <p class="section-label">KML Files</p>
    <form method="post" action="/upload" enctype="multipart/form-data" class="upload-form">
        <label class="upload-area" id="drop-zone">
            <input type="file" name="file" accept=".kml" required hidden>
            <span class="upload-text">Drop a .kml file here or click to browse</span>
        </label>
        <button type="submit" class="run-btn">Upload</button>
    </form>
    {% if kml_files %}
    <div class="file-list">
        {% for f in kml_files %}
        <div class="file-row">
            <span class="file-name">{{ f }}</span>
            <form method="post" action="/delete-kml/{{ f }}" style="display:inline">
                <button type="submit" class="delete-btn">&times;</button>
            </form>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p class="empty">No KML files uploaded yet.</p>
    {% endif %}
</section>

<script>
const zone = document.getElementById('drop-zone');
const input = zone.querySelector('input[type="file"]');
const text = zone.querySelector('.upload-text');
zone.addEventListener('click', () => input.click());
zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('drag-over'); });
zone.addEventListener('dragleave', () => zone.classList.remove('drag-over'));
zone.addEventListener('drop', e => {
    e.preventDefault();
    zone.classList.remove('drag-over');
    if (e.dataTransfer.files.length) {
        input.files = e.dataTransfer.files;
        text.textContent = e.dataTransfer.files[0].name;
    }
});
input.addEventListener('change', () => {
    if (input.files.length) text.textContent = input.files[0].name;
});
</script>
{% endblock %}
