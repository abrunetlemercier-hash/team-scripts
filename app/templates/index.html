{% extends "base.html" %}
{% block content %}
<p class="section-label">Internal Tools</p>
<h2>Available Scripts ({{ scripts|length }})</h2>
{% if scripts %}
<div class="script-list">
    {% for s in scripts %}
    <div class="script-card">
        <div class="script-info">
            <h3>{{ s.name }}</h3>
            <p>{{ s.description }}</p>
        </div>
        <form method="post" action="/run/{{ s.id }}">
            <button type="submit" class="run-btn">Run</button>
        </form>
    </div>
    {% endfor %}
</div>
{% else %}
<p class="empty">No scripts found.</p>
{% endif %}

<section class="upload-section">
    <p class="section-label">KML Files</p>
    <form method="post" action="/upload" enctype="multipart/form-data" class="upload-form" id="upload-form">
        <div class="upload-area" id="drop-zone">
            <input type="file" name="files" accept=".kml" multiple id="file-input">
            <span class="upload-text" id="upload-text">Drop .kml files here or click to browse</span>
        </div>
        <button type="submit" class="run-btn">Upload</button>
    </form>
    {% if kml_files %}
    <div class="file-list">
        {% for f in kml_files %}
        <div class="file-row">
            <span class="file-name">{{ f }}</span>
            <form method="post" action="/delete-kml/{{ f }}" style="display:inline">
                <button type="submit" class="delete-btn">&times;</button>
            </form>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p class="empty">No KML files uploaded yet.</p>
    {% endif %}
</section>

<script>
const zone = document.getElementById('drop-zone');
const input = document.getElementById('file-input');
const text = document.getElementById('upload-text');

zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('drag-over'); });
zone.addEventListener('dragleave', () => zone.classList.remove('drag-over'));
zone.addEventListener('drop', e => {
    e.preventDefault();
    zone.classList.remove('drag-over');
    const dt = new DataTransfer();
    for (const f of e.dataTransfer.files) {
        if (f.name.toLowerCase().endsWith('.kml')) dt.items.add(f);
    }
    if (dt.files.length) {
        input.files = dt.files;
        text.textContent = dt.files.length === 1
            ? dt.files[0].name
            : dt.files.length + ' files selected';
    }
});
input.addEventListener('change', () => {
    if (input.files.length === 1) text.textContent = input.files[0].name;
    else if (input.files.length > 1) text.textContent = input.files.length + ' files selected';
});
</script>
{% endblock %}
